---
import Navigation from "./Navigation.astro";
---

<header class="sticky top-0 z-50 w-full bg-white/90 dark:bg-slate-900/90 backdrop-blur-md shadow-sm">
  <div class="container flex items-center justify-between h-20">
    <a href="/" class="text-2xl font-bold text-primary-800 dark:text-primary-100 font-serif flex items-center site-brand">
      <span class="sr-only">ギークのためのサイクリング</span>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" class="h-12 w-auto text-primary-600 mr-2 site-icon" aria-hidden="true">
        <!-- Wheels -->
        <g stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round" fill="none">
          <circle cx="18" cy="46" r="10"/>
          <circle cx="46" cy="46" r="10"/>
          <!-- Spokes -->
          <g>
        <line x1="18" y1="46" x2="12" y2="40"/>
        <line x1="18" y1="46" x2="24" y2="40"/>
        <line x1="46" y1="46" x2="40" y2="40"/>
        <line x1="46" y1="46" x2="52" y2="40"/>
          </g>
          <!-- Frame -->
          <path d="M18 46 L28 34 L36 34 L46 46"/>
          <path d="M28 34 L33 24 L36 34"/>
          <!-- Fork & handlebars -->
          <path d="M36 34 L40 26 L46 26"/>
          <path d="M46 26 L50 24"/>
          <!-- Seat -->
          <path d="M30 26 L26 24"/>
        </g>

        <!-- geek glasses (pictogram detail) -->
        <g fill="currentColor" stroke="none">
          <rect x="34" y="14" width="6" height="4" rx="0.8"/>
          <rect x="44" y="14" width="6" height="4" rx="0.8"/>
          <rect x="40" y="15" width="4" height="1.6" rx="0.4"/>
        </g>

        <!-- Small circuit accents for "geek" feel -->
        <g stroke="currentColor" stroke-width="1.6" stroke-linecap="round" fill="none">
          <path d="M10 34 L6 28"/>
          <circle cx="6" cy="28" r="1.2" fill="currentColor"/>
          <path d="M58 34 L62 28"/>
          <circle cx="62" cy="28" r="1.2" fill="currentColor"/>
        </g>
      </svg>
      <span class="text-primary-800 site-subtitle">ギークのためのサイクリング</span>
    </a>
    
    <div class="flex items-center gap-4">
      <Navigation />
      <!-- Theme toggle -->
      <button id="theme-toggle" aria-label="Toggle dark mode" class="p-2 rounded-md text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors">
        <!-- Sun icon (shown in light mode) -->
        <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.36 6.36l-1.42-1.42M7.05 7.05 5.64 5.64m12.72 0L17.95 7.05M7.05 16.95 5.64 18.36M12 8a4 4 0 100 8 4 4 0 000-8z" />
        </svg>
        <!-- Moon icon (shown in dark mode) -->
        <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
        </svg>
      </button>
    </div>
  </div>
</header>

<script>
  // Theme toggle: store 'theme' in localStorage: 'dark' or 'light'
  (function () {
    const toggle = document.currentScript && document.currentScript.previousElementSibling && document.currentScript.previousElementSibling.querySelector
      ? document.currentScript.previousElementSibling.querySelector('#theme-toggle')
      : document.getElementById('theme-toggle');

    const iconSun = document.getElementById('icon-sun');
    const iconMoon = document.getElementById('icon-moon');

    function applyTheme(theme) {
      const root = document.documentElement;
      if (theme === 'dark') {
        root.classList.add('dark');
        if (iconSun) iconSun.classList.add('hidden');
        if (iconMoon) iconMoon.classList.remove('hidden');
      } else {
        root.classList.remove('dark');
        if (iconSun) iconSun.classList.remove('hidden');
        if (iconMoon) iconMoon.classList.add('hidden');
      }
    }

    // Initialize
    try {
      const stored = localStorage.getItem('theme');
      if (stored === 'dark' || stored === 'light') {
        applyTheme(stored);
      } else {
        // follow system preference
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(prefersDark ? 'dark' : 'light');
      }
    } catch (e) {
      // ignore
    }

    // Toggle handler
    if (toggle) {
      toggle.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        const next = isDark ? 'light' : 'dark';
        try { localStorage.setItem('theme', next); } catch (e) {}
        applyTheme(next);
      });
    }
  })();
</script>